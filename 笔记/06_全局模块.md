> 模块需要先导出provider,另一个模块需要Imports它后才能用这个provider
>
> 但如何这个模块被很多模块依赖了,那么每次都要imports就很麻烦,所以能不能设置成全局的,它所exports的provider直接可用呢?

# 全局模块 @global

> 1.创建Nest项目

```powershell
nest new 07_全局模块 -s -g -p pnpm
```

> 2.生成两个CRUD的测试模块 --no-spec表示不生成测试文件

```powershell
nest generate resource test1 --no-spec
nest generate resource test2 --no-spec
```

> 3.test1.module.ts中导出provider

```ts
// test1.module.ts
import { Module } from '@nestjs/common';
import { Test1Service } from './test1.service';
import { Test1Controller } from './test1.controller';

@Module({
  controllers: [Test1Controller],
  providers: [Test1Service],
  exports: [Test1Service], // 导出provider
})
export class Test1Module {}
```

> 4.test2.module.ts中引入Test1Module,然后就可以在当前模块注入并使用Test1Module导出的provider了.

```ts
import { Module } from '@nestjs/common';
import { Test2Service } from './test2.service';
import { Test2Controller } from './test2.controller';
import { Test1Module } from 'src/test1/test1.module';

@Module({
  controllers: [Test2Controller],
  providers: [Test2Service],
  imports: [Test1Module], // 引入Test1Module
})
export class Test2Module {}
```

> 5.在test2.controller.ts中注入并使用

```ts
import { Get } from '@nestjs/common';
import { Test2Service } from './test2.service';
import { Test1Service } from 'src/test1/test1.service';

@Controller('test2')
export class Test2Controller {
  constructor(
    private readonly test2Service: Test2Service,

     // 注入provider
    private readonly test1Service: Test1Service,
  ) {}

  @Get()
  test() {
    console.log(this.test1Service.findAll());
  }
}
```

> 这就是常用的使用方式.
>
> 但是如何这个Test1Module被模块引用呢?, 所以每个模块都需要imports一遍就太麻烦了,这时候就可以将Test1Module这个模块声明为全局的.
>
> 在Test1Module上加一个@Global装饰器就可以了, 这就是全局模块.
>
> 但是全局模块最好少用,不然注入的很多provider都不知道来源,会降低代码的可维护性.

```ts
// test1.module.ts

import { Global, Module } from '@nestjs/common';
import { Test1Service } from './test1.service';
import { Test1Controller } from './test1.controller';

@Global() // 声明为全局模块,其他模块想使用Test1Service这个provider时,不需要引入Test1Module了.
@Module({
  controllers: [Test1Controller],
  providers: [Test1Service],
  exports: [Test1Service],
})
export class Test1Module {}
```